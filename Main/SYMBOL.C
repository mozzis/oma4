/* -----------------------------------------------------------------------
/
/  symbol.c
/
/  Copyright (c) 1990,  EG&G Instruments Inc.
/
/  $Header:   J:/logfiles/oma4000/main/symbol.c_v   0.11   10 Jan 1992 16:58:20   cole  $
/  $Log:   J:/logfiles/oma4000/main/symbol.c_v  $
 * 
 *    Rev 0.11   10 Jan 1992 16:58:20   cole
 * Add include device.h and use device_handle() instead of window->dev_handle.
 * Remove PLOTBOX * argument from symbol(), StrBox(), and AlignText().
 * 
 *    Rev 0.10   25 Jul 1991 13:04:50   cole
 * Add $Header and $Log comment lines. Delete #include "cgibind.h"
/
/ ------------------------------------------------------------------------
*/

#include <math.h>
#include <string.h>

#include "symbol.h"
#include "device.h"  // deviceHandle()

#ifdef XSTAT
   #define PRIVATE
#else
   #define PRIVATE static
#endif

PRIVATE int ichars[128][15][3] = {
   0,0,0,
   3,0,0,
   0,0,0,
   0,0,0,
   0,3,0,
   0,0,0,
   0,0,0,
   3,0,1,
   0,0,0,
   0,4,0,
   3,0,0,
   0,0,0,
   3,0,0,
   0,3,0,
   0,0,0,
   0,2,0,
   0,0,3,
   0,0,0,
   1,1,3,
   0,0,0,
   0,0,0,
   0,0,0,
   3,3,0,
   0,0,0,
   0,0,0,
   0,0,3,
   0,0,0,
   0,0,0,
   0,3,0,
   0,0,0,
   4,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   3,0,0,
   0,0,0,
   0,0,3,
   4,0,0,
   0,0,0,
   0,1,1,
   0,0,0,
   0,0,0,
   0,0,0,
   1,3,3,
   0,0,0,
   0,0,0,
   0,3,0,
   0,0,0,
   0,0,0,
   3,0,1,
   0,0,0,
   0,4,0,
   3,0,0,
   0,0,0,
   3,0,0,
   0,3,0,
   0,0,0,
   0,0,0,
   0,4,0,
   0,0,0,
   1,0,0,
   0,0,3,
   0,0,0,
   0,0,0,
   1,0,0,
   0,0,0,
   0,0,0,
   1,0,0,
   0,0,0,
   0,0,3,
   0,0,0,
   0,0,0,
   0,1,1,
   0,0,0,
   0,0,0,
   0,0,0,
   3,0,0,
   0,0,0,
   0,0,2,
   0,3,0,
   0,0,0,
   0,0,0,
   3,0,1,
   0,0,0,
   0,4,0,
   3,0,0,
   0,0,0,
   3,0,1,
   0,3,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,3,
   0,0,0,
   0,0,3,
   1,1,0,
   0,0,0,
   0,0,0,
   0,0,3,
   0,0,0,
   0,1,0,
   1,0,0,
   0,0,0,
   4,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   3,0,0,
   0,0,0,
   0,0,0,
   1,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,1,0,
   0,0,0,
   1,0,0,
   0,0,0,
   0,0,0,
   0,7,0,
   1,0,0,
   0,0,0,
   0,8,0,
   0,0,0,
   0,0,0,
   0,0,0,
   1,0,0,
   0,0,0,
   0,1,0,
   0,0,0,
   0,0,0,
   0,0,3,
   0,0,0,
   0,1,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,3,3,
   0,0,0,
   0,3,0,
   1,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,1,
   0,0,0,
   0,0,0,
   0,0,0,
   1,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   1,0,0,
   0,0,0,
   0,0,0,
   1,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   7,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   6,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,2,
   0,2,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,2,
   0,2,0,
   2,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,2,
   0,2,0,
   2,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,2,
   0,2,0,
   2,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,2,
   0,2,0,
   2,0,0,
   0,0,0,
   2,2,0,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   4,0,0,
   3,0,1,
   3,1,1,
   5,1,1,
   5,0,1,
   4,0,1,
   4,3,0,
   4,6,1,
   3,7,1,
   3,10,1,
   5,10,1,
   5,7,1,
   4,6,1,
   0,0,2,
   0,0,0,
   2,10,0,
   2,7,1,
   5,10,0,
   5,7,1,
   0,0,2,
   4,3,0,
   4,4,1,
   5,4,1,
   3,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,8,0,
   8,8,1,
   0,1,0,
   8,1,1,
   2,10,0,
   2,0,1,
   6,10,0,
   6,0,1,
   0,0,2,
   0,0,2,
   3,4,1,
   3,5,1,
   4,6,1,
   5,6,1,
   5,3,1,
   8,8,0,
   7,9,1,
   1,9,1,
   0,8,1,
   0,6,1,
   8,4,1,
   8,2,1,
   7,1,1,
   1,1,1,
   0,2,1,
   4,10,0,
   4,0,1,
   0,0,2,
   5,6,1,
   5,3,1,
   0,10,0,
   0,8,1,
   2,8,1,
   2,10,1,
   0,10,1,
   0,0,0,
   8,10,1,
   8,0,0,
   8,2,1,
   6,2,1,
   6,0,1,
   8,0,1,
   0,0,2,
   5,6,1,
   5,3,1,
   8,5,0,
   5,0,1,
   1,0,1,
   0,1,1,
   0,3,1,
   6,6,1,
   6,9,1,
   4,10,1,
   2,9,1,
   2,6,1,
   8,0,1,
   0,0,2,
   0,0,2,
   0,0,0,
   0,0,0,
   5,10,0,
   5,8,1,
   4,6,1,
   0,0,2,
   0,0,2,
   4,3,0,
   4,4,1,
   5,4,1,
   3,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   4,10,0,
   0,8,1,
   0,2,1,
   4,0,1,
   0,0,2,
   4,8,1,
   2,5,0,
   6,5,1,
   0,0,2,
   4,2,1,
   5,4,1,
   6,5,1,
   0,0,2,
   0,0,0,
   0,0,0,
   4,10,0,
   8,8,1,
   8,2,1,
   4,0,1,
   0,0,2,
   4,8,1,
   2,5,0,
   6,5,1,
   0,0,2,
   4,2,1,
   5,4,1,
   6,5,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   8,10,1,
   0,10,0,
   8,0,1,
   4,0,0,
   4,10,1,
   0,5,0,
   8,5,1,
   0,0,2,
   4,2,1,
   5,4,1,
   6,5,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,5,0,
   8,5,1,
   4,10,0,
   4,0,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   3,6,0,
   3,4,1,
   5,4,1,
   5,6,1,
   3,6,1,
   5,4,0,
   3,2,1,
   0,0,2,
   3,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,5,0,
   8,5,1,
   0,0,2,
   4,2,1,
   0,0,2,
   4,8,1,
   2,5,0,
   6,5,1,
   0,0,2,
   4,2,1,
   5,4,1,
   6,5,1,
   0,0,2,
   0,0,0,
   0,0,0,
   3,0,0,
   3,2,1,
   5,2,1,
   5,0,1,
   3,0,1,
   0,0,2,
   4,4,1,
   5,4,1,
   3,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   8,10,1,
   0,0,2,
   4,6,1,
   4,4,1,
   4,3,0,
   4,2,1,
   0,0,2,
   3,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,9,0,
   2,10,1,
   6,10,1,
   8,9,1,
   8,1,1,
   6,0,1,
   2,0,1,
   0,1,1,
   0,9,1,
   0,0,0,
   8,10,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   2,9,0,
   4,10,1,
   4,0,1,
   2,0,1,
   4,1,1,
   6,0,1,
   4,0,1,
   0,0,2,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,9,0,
   1,10,1,
   7,10,1,
   8,9,1,
   8,5,1,
   0,1,1,
   0,0,1,
   8,0,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,9,0,
   1,10,1,
   7,10,1,
   8,9,1,
   8,6,1,
   7,5,1,
   4,5,1,
   7,5,0,
   8,4,1,
   8,1,1,
   7,0,1,
   1,0,1,
   0,1,1,
   0,1,1,
   0,0,2,
   6,0,0,
   6,10,1,
   0,5,1,
   8,5,1,
   0,0,2,
   5,5,1,
   3,5,1,
   5,5,0,
   6,4,1,
   6,3,1,
   5,2,1,
   3,2,1,
   2,3,1,
   0,0,2,
   0,0,0,
   8,10,0,
   0,10,1,
   0,5,1,
   7,5,1,
   8,4,1,
   8,1,1,
   7,0,1,
   1,0,1,
   0,1,1,
   0,0,2,
   5,2,1,
   3,2,1,
   2,3,1,
   0,0,2,
   0,0,0,
   8,9,0,
   7,10,1,
   1,10,1,
   0,9,1,
   0,1,1,
   1,0,1,
   7,0,1,
   8,1,1,
   8,4,1,
   7,5,1,
   0,5,1,
   0,0,2,
   2,3,1,
   0,0,2,
   0,0,0,
   0,10,0,
   8,10,1,
   8,7,1,
   4,4,1,
   4,0,1,
   0,0,2,
   2,3,1,
   2,7,1,
   3,8,1,
   5,8,1,
   6,7,1,
   0,0,2,
   2,3,1,
   0,0,2,
   0,0,0,
   1,5,0,
   0,6,1,
   0,9,1,
   1,10,1,
   7,10,1,
   8,9,1,
   8,6,1,
   7,5,1,
   1,5,1,
   0,4,1,
   0,1,1,
   1,0,1,
   7,0,1,
   8,1,1,
   8,4,1,
   0,0,0,
   7,0,1,
   8,1,1,
   8,9,1,
   7,10,1,
   1,10,1,
   0,9,1,
   0,6,1,
   1,5,1,
   8,5,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   3,6,0,
   3,8,1,
   5,8,1,
   5,6,1,
   3,6,1,
   3,4,0,
   3,2,1,
   5,2,1,
   5,4,1,
   3,4,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   3,6,0,
   3,8,1,
   5,8,1,
   5,6,1,
   3,6,1,
   3,4,0,
   3,2,1,
   5,2,1,
   5,4,1,
   3,4,1,
   5,2,0,
   3,0,1,
   0,0,2,
   0,0,0,
   0,0,0,
   4,10,0,
   0,5,1,
   4,0,1,
   0,0,2,
   6,7,1,
   0,0,2,
   4,4,1,
   5,4,1,
   3,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,7,0,
   8,7,1,
   0,3,0,
   8,3,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   4,10,0,
   8,5,1,
   4,0,1,
   0,0,2,
   0,0,2,
   0,0,2,
   4,4,1,
   5,4,1,
   3,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,8,0,
   0,9,1,
   1,10,1,
   7,10,1,
   8,9,1,
   8,7,1,
   4,6,1,
   4,3,1,
   3,2,0,
   3,0,1,
   5,0,1,
   5,2,1,
   3,2,1,
   0,0,2,
   0,0,0,
   7,0,0,
   1,0,1,
   0,1,1,
   0,9,1,
   1,10,1,
   7,10,1,
   8,9,1,
   8,2,1,
   3,2,1,
   2,3,1,
   2,6,1,
   3,7,1,
   6,7,1,
   7,6,1,
   7,2,1,
   0,0,0,
   0,6,1,
   4,10,1,
   8,6,1,
   8,0,1,
   0,5,0,
   8,5,1,
   0,0,2,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,10,0,
   7,10,1,
   8,9,1,
   8,6,1,
   7,5,1,
   1,5,1,
   7,5,0,
   8,4,1,
   8,1,1,
   7,0,1,
   0,0,1,
   1,0,0,
   1,10,1,
   0,0,2,
   0,0,2,
   8,2,0,
   7,0,1,
   2,0,1,
   0,1,1,
   0,9,1,
   2,10,1,
   7,10,1,
   8,8,1,
   0,0,2,
   6,3,1,
   5,2,1,
   2,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   6,0,1,
   8,2,1,
   8,8,1,
   6,10,1,
   0,10,1,
   1,10,0,
   1,0,1,
   0,0,2,
   6,3,1,
   5,2,1,
   2,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   8,0,1,
   8,1,1,
   7,0,1,
   0,10,0,
   8,10,1,
   8,9,1,
   7,10,1,
   1,10,0,
   1,0,1,
   1,5,0,
   6,5,1,
   0,0,2,
   5,5,1,
   0,0,2,
   0,0,0,
   2,0,1,
   1,0,1,
   1,0,0,
   1,10,1,
   0,10,0,
   8,10,1,
   8,9,1,
   7,10,1,
   1,5,0,
   6,5,1,
   0,0,2,
   0,0,2,
   0,0,0,
   0,0,0,
   8,8,0,
   6,10,1,
   2,10,1,
   0,8,1,
   0,2,1,
   2,0,1,
   6,0,1,
   8,2,1,
   8,4,1,
   4,4,1,
   8,2,0,
   8,0,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,10,0,
   0,0,1,
   8,10,0,
   8,0,1,
   8,5,0,
   0,5,1,
   0,0,2,
   6,8,1,
   0,0,2,
   6,3,1,
   5,2,1,
   2,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   2,0,0,
   6,0,1,
   6,0,1,
   2,10,0,
   6,10,1,
   4,10,0,
   4,0,1,
   0,0,2,
   7,9,1,
   7,8,1,
   0,0,2,
   2,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,2,0,
   2,0,1,
   6,0,1,
   6,10,1,
   3,10,0,
   8,10,1,
   0,0,2,
   6,10,1,
   7,9,1,
   7,10,1,
   6,10,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   1,0,1,
   1,10,1,
   0,10,1,
   8,10,0,
   8,9,1,
   1,5,1,
   7,1,1,
   7,0,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,10,0,
   0,0,1,
   6,0,1,
   6,1,1,
   5,0,1,
   0,0,2,
   1,9,1,
   3,9,1,
   2,8,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,10,1,
   4,7,1,
   8,10,1,
   8,0,1,
   0,0,2,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,10,1,
   8,2,1,
   8,10,0,
   8,0,1,
   0,0,2,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   2,0,0,
   0,2,1,
   0,8,1,
   2,10,1,
   6,10,1,
   8,8,1,
   8,2,1,
   6,0,1,
   2,0,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   1,0,0,
   0,0,1,
   1,1,1,
   2,0,1,
   1,0,1,
   1,10,1,
   0,10,0,
   7,10,1,
   8,9,1,
   8,6,1,
   7,5,1,
   1,5,1,
   0,0,2,
   0,0,0,
   0,0,0,
   2,1,0,
   0,3,1,
   0,8,1,
   2,10,1,
   6,10,1,
   8,8,1,
   8,3,1,
   6,1,1,
   2,1,1,
   5,3,0,
   8,0,1,
   0,0,2,
   0,0,2,
   0,0,0,
   0,0,0,
   1,0,0,
   0,0,1,
   1,1,1,
   2,0,1,
   1,0,1,
   1,10,1,
   0,10,0,
   7,10,1,
   8,9,1,
   8,6,1,
   7,5,1,
   1,5,1,
   8,0,0,
   6,5,1,
   6,5,1,
   8,7,0,
   8,8,1,
   6,10,1,
   2,10,1,
   0,8,1,
   0,6,1,
   8,3,1,
   8,2,1,
   5,0,1,
   2,0,1,
   0,2,1,
   0,0,2,
   0,0,2,
   0,0,0,
   0,0,0,
   4,0,0,
   4,10,1,
   1,10,0,
   0,9,1,
   0,10,1,
   8,10,1,
   8,9,1,
   7,10,1,
   0,0,2,
   5,1,1,
   0,0,2,
   5,1,1,
   5,2,1,
   4,1,1,
   0,0,2,
   0,10,0,
   0,1,1,
   1,0,1,
   7,0,1,
   8,1,1,
   8,10,1,
   0,0,2,
   0,0,2,
   3,8,1,
   6,8,1,
   0,0,2,
   4,4,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,10,0,
   0,3,1,
   4,0,1,
   8,3,1,
   8,10,1,
   0,0,2,
   0,0,2,
   2,7,1,
   3,8,1,
   6,8,1,
   0,0,2,
   4,4,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,10,0,
   0,2,1,
   2,0,1,
   4,4,1,
   6,0,1,
   8,2,1,
   8,10,1,
   0,0,2,
   3,8,1,
   6,8,1,
   0,0,2,
   4,4,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,10,0,
   0,9,1,
   8,1,1,
   8,0,1,
   0,0,0,
   0,1,1,
   8,9,1,
   8,10,1,
   0,0,2,
   6,8,1,
   0,0,2,
   4,4,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,10,0,
   0,7,1,
   4,4,1,
   8,7,1,
   8,10,1,
   4,4,0,
   4,0,1,
   0,0,2,
   4,1,0,
   5,1,1,
   0,0,2,
   4,4,1,
   0,0,2,
   0,0,0,
   0,0,0,
   1,10,0,
   0,9,1,
   0,10,1,
   8,10,1,
   0,0,1,
   8,0,1,
   8,1,1,
   7,0,1,
   0,0,2,
   6,8,1,
   0,0,2,
   4,4,1,
   0,0,2,
   0,0,0,
   0,0,0,
   3,10,0,
   0,10,1,
   0,0,1,
   3,0,1,
   0,0,2,
   2,5,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,10,0,
   8,0,1,
   0,0,2,
   4,6,1,
   4,4,1,
   4,3,0,
   4,2,1,
   0,0,2,
   3,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   5,10,0,
   8,10,1,
   8,0,1,
   5,0,1,
   0,0,2,
   6,5,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,7,0,
   4,10,1,
   8,7,1,
   0,0,2,
   0,0,0,
   0,5,3,
   0,0,0,
   0,0,0,
   0,0,1,
   1,0,0,
   0,0,0,
   2,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   8,0,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,9,0,
   0,10,1,
   4,9,1,
   0,0,2,
   6,7,1,
   0,0,2,
   4,4,1,
   5,4,1,
   3,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   1,0,0,
   0,1,1,
   0,2,1,
   1,3,1,
   7,3,1,
   8,2,1,
   8,1,1,
   7,0,1,
   2,0,1,
   3,5,0,
   7,5,1,
   8,4,1,
   8,0,1,
   0,0,2,
   0,0,2,
   0,9,0,
   1,10,1,
   1,0,1,
   7,0,1,
   8,1,1,
   8,3,1,
   7,4,1,
   1,4,1,
   0,0,2,
   0,9,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   8,4,0,
   7,5,1,
   1,5,1,
   0,4,1,
   0,1,1,
   1,0,1,
   7,0,1,
   8,1,1,
   0,0,2,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   8,9,0,
   7,10,1,
   8,10,1,
   8,0,1,
   8,1,0,
   7,0,1,
   1,0,1,
   0,1,1,
   0,4,1,
   1,5,1,
   7,5,1,
   7,5,0,
   8,4,1,
   0,0,2,
   0,0,0,
   8,1,0,
   7,0,1,
   1,0,1,
   0,1,1,
   0,4,1,
   2,5,1,
   6,5,1,
   8,4,1,
   8,3,1,
   6,2,1,
   0,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   5,9,0,
   4,10,1,
   2,10,1,
   1,9,1,
   1,0,1,
   0,0,0,
   2,0,1,
   0,4,0,
   3,4,1,
   0,0,2,
   0,0,2,
   1,4,1,
   0,0,2,
   0,0,0,
   2,0,0,
   8,1,0,
   7,0,1,
   1,0,1,
   0,1,1,
   0,4,1,
   1,5,1,
   7,5,1,
   8,4,1,
   8,-2,1,
   7,-3,1,
   3,-3,1,
   2,-2,1,
   2,-2,1,
   0,0,2,
   0,0,2,
   0,10,0,
   0,0,1,
   0,0,1,
   0,4,0,
   2,5,1,
   6,5,1,
   8,4,1,
   8,0,1,
   0,0,2,
   6,1,1,
   0,0,2,
   0,0,0,
   1,1,1,
   0,0,0,
   0,0,0,
   3,0,0,
   5,0,1,
   4,0,0,
   4,5,1,
   4,7,0,
   4,6,1,
   5,6,1,
   5,7,1,
   4,7,1,
   0,0,2,
   4,9,1,
   0,0,2,
   0,0,0,
   0,0,0,
   7,0,0,
   4,5,0,
   4,-1,1,
   3,-2,1,
   1,-2,1,
   0,-1,1,
   4,6,0,
   5,6,1,
   5,7,1,
   4,7,1,
   4,6,1,
   0,0,2,
   0,0,2,
   0,0,0,
   0,0,0,
   1,0,0,
   0,10,0,
   1,10,1,
   1,0,1,
   0,0,1,
   1,3,0,
   6,5,1,
   1,3,0,
   5,0,1,
   0,0,2,
   0,0,0,
   0,0,0,
   1,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   3,9,0,
   4,10,1,
   4,0,1,
   3,0,1,
   4,1,1,
   5,0,1,
   4,0,1,
   0,0,2,
   0,5,0,
   1,0,0,
   0,0,0,
   1,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,4,1,
   2,5,1,
   4,5,1,
   4,2,1,
   4,5,0,
   6,5,1,
   8,4,1,
   8,0,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   1,5,0,
   1,0,1,
   1,4,0,
   3,5,1,
   7,5,1,
   8,4,1,
   8,0,1,
   1,5,0,
   0,6,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   1,0,0,
   0,1,1,
   0,4,1,
   1,5,1,
   7,5,1,
   8,4,1,
   8,1,1,
   7,0,1,
   1,0,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   3,0,0,
   0,5,0,
   1,5,1,
   1,-2,1,
   1,1,0,
   2,0,1,
   7,0,1,
   8,1,1,
   8,4,1,
   7,5,1,
   3,5,1,
   2,5,1,
   1,4,1,
   0,0,2,
   0,0,2,
   0,0,0,
   1,0,0,
   0,1,1,
   0,4,1,
   1,5,1,
   6,5,1,
   7,4,1,
   7,1,1,
   6,0,1,
   1,0,1,
   8,5,0,
   7,4,1,
   7,-3,1,
   7,-3,1,
   0,0,2,
   0,0,2,
   0,5,0,
   1,4,1,
   1,0,1,
   1,3,0,
   3,5,1,
   7,5,1,
   8,4,1,
   0,0,2,
   6,6,1,
   6,5,1,
   0,0,2,
   0,0,1,
   0,0,0,
   0,0,0,
   0,1,1,
   8,4,0,
   6,5,1,
   2,5,1,
   0,4,1,
   0,3,1,
   8,1,1,
   6,0,1,
   2,0,1,
   0,1,1,
   0,0,2,
   0,0,0,
   0,4,0,
   3,0,0,
   0,0,0,
   3,0,0,
   2,9,0,
   2,1,1,
   3,0,1,
   7,0,1,
   8,1,1,
   0,5,0,
   5,5,1,
   0,0,2,
   0,0,2,
   3,3,0,
   0,0,0,
   0,0,0,
   0,0,3,
   0,0,0,
   0,0,0,
   0,5,0,
   0,1,1,
   1,0,1,
   6,0,1,
   7,1,1,
   7,5,1,
   7,1,0,
   8,0,1,
   0,0,2,
   4,0,0,
   0,0,0,
   0,1,1,
   0,0,0,
   0,0,0,
   0,0,0,
   0,5,0,
   0,2,1,
   4,0,1,
   8,2,1,
   8,5,1,
   0,0,2,
   7,6,1,
   0,0,2,
   0,4,0,
   3,0,0,
   0,0,0,
   3,0,0,
   0,3,0,
   0,0,0,
   0,0,0,
   0,5,0,
   0,1,1,
   1,0,1,
   4,0,1,
   4,2,1,
   4,0,0,
   7,0,1,
   8,1,1,
   8,5,1,
   0,0,2,
   0,0,2,
   0,0,3,
   0,0,0,
   0,0,0,
   0,1,1,
   0,0,0,
   8,5,1,
   0,5,0,
   8,0,1,
   0,0,2,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   3,0,0,
   0,0,0,
   0,0,0,
   3,0,0,
   0,0,0,
   3,0,0,
   0,5,0,
   0,1,1,
   1,0,1,
   7,0,1,
   7,0,0,
   8,1,1,
   8,5,1,
   8,1,0,
   8,-2,1,
   7,-3,1,
   3,-3,1,
   3,-3,1,
   0,0,2,
   0,0,0,
   0,0,0,
   1,5,0,
   0,4,1,
   0,5,1,
   8,5,1,
   0,0,1,
   8,0,1,
   8,1,1,
   7,0,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   4,10,0,
   1,8,1,
   1,2,1,
   4,0,1,
   0,5,0,
   1,5,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   4,10,0,
   4,6,1,
   4,6,1,
   4,4,0,
   4,0,1,
   0,0,2,
   4,2,1,
   0,0,2,
   3,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   4,10,0,
   7,9,1,
   7,1,1,
   4,0,1,
   7,5,0,
   8,5,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,8,0,
   2,10,1,
   4,8,1,
   6,10,1,
   8,8,1,
   0,0,2,
   4,4,1,
   5,4,1,
   3,2,1,
   0,0,2,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   1,0,0,
   0,0,0,
   1,0,0,
   2,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,0,
   0,0,2,
   7,1,3,
   3,1,0,
   2,1,0,
   5,0,0,
   5,1,0,
   0,2,0,
};

void symbol(CXY *TextPt, char * s, float angle, float cell_width,
            float cell_height )
{
  float si,c,xs,ys,x0,y0,xp,yp;
  int n,icnt,m,l,i,j,k, iplt;
  CXY xypa[15];

  /* symbol print string at location x,y with angle angle (in radians)
    calculate sines and cosines needed for rotation              */
  
  si= (float) sin(angle);
  c= (float)cos(angle);

  xs= (float) TextPt->x;
  ys= (float) TextPt->y;

  /* start loop for each character */
  n=strlen(s);
  for (icnt = 0 ; icnt < n ; icnt++)
    {
    /* l is ascii integer of character (ie A=65, B=66, ect.) */
    l = s[icnt];

    //DD      /* for now ignore lower case (make them upper case) */
    //DD     if (l >= 96 && l <= 122)  l=l-32;
    l=l-1;

    iplt = 0;
    if (s[icnt] != ' ')
      {
      /* m is the point counter for character */
      for (m= 0; m < 16; m++)
        {
        /*  i is the x co-ordinate
          j is the y co-ordinate
          k is the pen control
          these are for a 6X9 matrix for a up right 1" high character */
        i=ichars[l][m][0];
        j=ichars[l][m][1];
        k=ichars[l][m][2];

        /* calculate correct x,y co-ordinates (un-rotated) */
        // x0= ((float) (i-1)/ (float) 6.0 * cell_width) +
        //                                              (float) (icnt * cell_width);
        // y0= ((float) (j-1)/ (float) (9.0)) * cell_height;
  
        x0= (((float) i / (float) 11) * cell_width) +
          (float) (icnt * cell_width);
        y0= ((float) j / (float) 13) * cell_height;

        /* now scale rotate and plot */
        xp=x0*c-y0*si;
        yp=x0*si+y0*c;
        xp += xs;
        yp += ys;

        if (k == 1)
          {
          xypa[iplt].x = (int) xp;
          xypa[iplt].y = (int) yp;
          iplt++;
          }

        if (k == 0)
          {
          if (iplt != 0)
            CPolyline( deviceHandle(), iplt, xypa ) ;

          xypa[0].x = (int) xp;
          xypa[0].y = (int) yp;
          iplt = 1;
          }

        if (k == 2 ) break;
        }  /* for m < 16 */
      } /* if s[icnt] != space */
    if (iplt != 0)
      CPolyline( deviceHandle(), iplt, xypa ) ;
    } /* for icnt */
  return;
}
  
PRIVATE void StrBox( char * text, float angle, float cell_width,
                     float cell_height, CXY * LLeftPt, CXY * LRightPt,
                     CXY * URightPt, CXY * ULeftPt, USHORT * length )
{
   /* angle (in radians), calculate sines and cosines needed for rotation */
   float c  = (float) cos(angle) ;
   float si = (float) sin(angle) ;
  
   * length = (USHORT) (cell_width * (float) strlen( text ) ) ;
  
   /* lower left corner will always be at 0.0 */
   LLeftPt->x = 0;
   LLeftPt->y = 0;
  
   /* adjust for string rotation */
   LRightPt->x = (int) (c * *length);
   LRightPt->y = (int) (si * *length);
  
   /* adjust for character rotation */
   URightPt->x = LRightPt->x - (int) (si * cell_height);
   URightPt->y = LRightPt->y + (int) (c * cell_height);
  
   ULeftPt->x = URightPt->x - LRightPt->x;
   ULeftPt->y = URightPt->y - LRightPt->y;
}

/* -----------------------------------------------------------------------
/
/  SHORT AlignText( SHORT cell_width, SHORT cell_height,
/                   SHORT xalign, SHORT yalign, CHAR * string,
/                   CXY * alignment_pt, DOUBLE angle )
/
/  function:   Resets alignment_pt to get the proper alignment if drawn
/              with current text characteristics.
/
/  requires:   (FLOAT) cell_width - width of character cell
/              (FLOAT) cell_height - height of character cell
/              (SHORT) xalign - the X alignment indicator ALIGN_LEFT |
/                               ALIGN_RIGHT | ALIGN_CENTER
/              (SHORT) yalign - the Y alignment indicator ALIGN_TOP |
/                               ALIGN_BOTTOM | ALIGN_CENTER
/              (CHAR *) string - the null ended string to be written
/              (CXY *) alignment_pt - Input. Relative point to align on
/                                     Output. Lower left coordinate of
/                                     string in order to get proper
/                                     alignment
/              (FLOAT) angle - writing angle in radians
/
/  returns:    (int) FALSE
/
/  side effects: none
/
/ ----------------------------------------------------------------------- */
SHORT AlignText(FLOAT cell_width, FLOAT cell_height,
                SHORT xalign, SHORT yalign, CHAR * string,
                CXY * alignment_pt, FLOAT angle )
{
   USHORT string_length;
   CXY LLeftPt, LRightPt, URightPt, ULeftPt;
  
   StrBox( string, angle, cell_width, cell_height,
           &LLeftPt, &LRightPt, &URightPt, &ULeftPt, &string_length);
  
   switch( xalign )
   {
      case CTX_Left:
         /* stays the same */
         break;
      case CTX_Center:
         alignment_pt->x -= LRightPt.x / 2;
         alignment_pt->y -= LRightPt.y / 2;
         break;
      case CTX_Right:
         alignment_pt->x -= LRightPt.x;
         alignment_pt->y -= LRightPt.y;
         break;
   }
  
   switch( yalign )
   {
      case CTX_Center:
         alignment_pt->x -= ULeftPt.x / 2;
         alignment_pt->y -= ULeftPt.y / 2;
         break;
      case CTX_Top:
         alignment_pt->x -= ULeftPt.x;
         alignment_pt->y -= ULeftPt.y;
         break;
      case CTX_Bottom:
         /* nothing to do here */
         break;
   }
  
   return FALSE;
}
